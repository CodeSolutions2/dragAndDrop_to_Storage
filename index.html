<!DOCTYPE html>
<html>
<head></head>
<body>

<!-- <input id="input_text" type="text" value="" placeholder="" rows="10" cols="100" style="display:block; text-align: left; width: 600px;"> -->

<button id="run" onclick="run()">run</button>

<div id="notification"></div>

	
<script>

// -----------------------------------------------

async function run() {

	var arr_3d = [[[1], [2]], [[3], [4]]];
	document.getElementById('notification').innerHTML = arr_3d.toString();

	var output_shape = await shape(arr_3d);
	console.log('output_shape: ', output_shape);  // 2, 2, 1

	// -------------------------

	document.getElementById('notification').innerHTML += "<br>";

	// -------------------------
	
	var dims = [2, 1, 2]; // [desired_0th_dim, desired_1st_dim, desired_2nd_dim]
	var desired_3d = await exchange_3d_dimensions(arr_3d, dims);
	console.log("desired_3d: ", desired_3d);
	document.getElementById('notification').innerHTML += desired_3d.toString();
	
	output_shape = await shape(desired_3d);
	console.log('output_shape: ', output_shape);  // 2, 2, 1
}

// -----------------------------------------------

async function recur_func(arr) {
	if (arr != undefined) {
		return [arr[0], arr.length];
	} else {
		return arr;
	}
}
	
async function shape(arr) {
	var out = await recur_func(arr);
	var shap = [out[1]];
	var c = 0; // typically work with 4D arrays or less
	while (out != undefined && c < 4) {
		out = await recur_func(out[0]);
		if (out != undefined) {
			shap.push(out[1]);
		}
		c = c + 1;
	}
	return shap.slice(0, shap.length-1);
}
	
// -----------------------------------------------

async function zeros(dims) {

	// dims: [desired_0th_dim, desired_1st_dim, desired_2nd_dim]

	var out = [];
	
	if (dims.length == 1) {
		var desired_0th_dim = dims.at(0);
		
		out = Array.from({length: desired_0th_dim}, (val, ind) => { return 0; }); 

	} else if (dims.length == 2) {
		var desired_0th_dim = dims.at(0);
		var desired_1st_dim = dims.at(1);
		
		for (var i=0; i<desired_0th_dim; i++) {
			var arr = Array.from({length: desired_1st_dim}, (val, ind) => { return 0; }); 
			out.push(arr);
		}

	} else if (dims.length == 3) {
		var desired_0th_dim = dims.at(0);
		var desired_1st_dim = dims.at(1);
		var desired_2nd_dim = dims.at(2);
		
		for (var i=0; i<desired_0th_dim; i++) {
			temp = [];
			for (var j=0; j<desired_1st_dim; j++) {
				var arr = Array.from({length: desired_2nd_dim}, (val, ind) => { return 0; }); 
				temp.push(arr);
			}
			out.push(temp);
		}
		
	} else {
		console.log('Enter an array of length 1, 2, or 3. (ie: [desired_0th_dim, desired_1st_dim, desired_2nd_dim])')
	}
	
	return out;
}
	
// -----------------------------------------------
			
async function exchange_3d_dimensions(arr_3d, dims) {

	// [0] List the original array location_values and values
	var a = [];
	var b = [];
	var c = [];
	var val = [];

	for (var i=0; i<arr_3d.length; i++) {
		for (var j=0; j<arr_3d[0].length; j++) {
			for (var k=0; k<arr_3d[0][0].length; k++) {
			       a.push(i);
			       b.push(j);
			       c.push(k);
			       val.push(arr_3d[i][j][k])
			}
		}
	}
	console.log('a: ', a);
	console.log('b: ', b);
	console.log('c: ', c);
	console.log('val: ', val);

	// [1] Make the new shape array, filled with zeros
	var desired_3d = await zeros(dims);

	// [2] Fill in output shaped 3d array
	var desired_0th_dim = dims.at(0);
	var desired_1st_dim = dims.at(1);
	var desired_2nd_dim = dims.at(2);
	
	for (var i=0; i<desired_0th_dim; i++) {
		console.log('i: ', i);
		
		for (var j=0; j<desired_1st_dim; j++) {
			console.log('j: ', j);
			
			for (var k=0; k<desired_2nd_dim; k++) {
				console.log('k: ', k);

				// cycle over the index of a for every i,j,k value
			       for (var ind=0; ind<a.length; ind++) {
				       if (a.at(ind) == i && b.at(ind) == j && c.at(ind) == k) {
						desired_3d[i][j][k] = val.at(ind);
				       }
			       }
			}
		}
	}
			       
	return desired_3d;       
}

// -----------------------------------------------


// -----------------------------------------------

</script>
</body>
</html>
