<!DOCTYPE html>
<html>
<head></head>
<body>

<input id="location_name" type="text" value="" placeholder="location_name" rows="10" cols="100" style="display:block; text-align: left; width: 600px;">

<button id="run_script" onclick="run_script()">run_script</button>
<button id="regular_fetch" onclick="regular_fetch()">regular_fetch</button>
<button id="run_selection_w_JSONP" onclick="run_selection_w_JSONP()">run_selection_w_JSONP</button>
<button id="run_selection_w_CORS" onclick="run_selection_w_CORS()">run_selection_w_CORS</button>

	
<!-- <script src='https://code.jquery.com/jquery-3.6.3.min.js'></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
	
// -----------------------------------------------
	
window.addEventListener('beforeunload', function() {
    window.location.href = window.location.href + '?nocache=' + new Date().getTime();
});

// -----------------------------------------------

var url = `https://nominatim.openstreetmap.org/search?q=${document.getElementById('location_name').innerHTML}&format=json`;

// -----------------------------------------------


async function script_method(url, callback) {

	const scriptElement = document.createElement('script');

	scriptElement.src = `${url}&callback=callback`;
	scriptElement.type="text/javascript";
	scriptElement.crossorigin="anonymous";
}
	
function func_callback(response) {
	var meta = response.meta;
	var data = response.data;
	console.log(meta);
	console.log(data);
}

document.getElementById('run_script').onclick = async function() {
	await script_method(url, func_callback);
};

	
// -----------------------------------------------
	
async function regular_fetch() {

	var headers = {
		"Content-Type": "application/json",
		"Connection": "keep-alive",
		"Access-Control-Allow-Origin": "*",
	};
	var options = {
		method : 'GET',
		mode: 'cors',
		cache: "no-cache",
		// crossorigin: 'anonymous',
		crossorigin: '*',
		headers: new Headers(headers),
		redirect: "follow"
	};
	
	await fetch(url, options)
		.then(response => response.json())
		.then(async function(data) { console.log('data: ', data); })
		.catch(error => console.error("error: ", error));

}

// -----------------------------------------------
	
function run_selection_w_JSONP() {
	
	var settings = {
		type: 'GET',
		url: url,
		dataType: 'jsonp',
		jsonpCallback: 'myCallBackMethod',
		async: false, // this is by default false, so not need to mention
		crossDomain: true // tell the browser to allow cross domain calls.
		// success: successResopnse, jsonpCallback will call the successCallback
		// error: failureFunction jsonp does not support errorCallback. So cannot use this 
	};

	// [Step 0] Declare a constant variable proxy as a function
	const proxy = function(response) { 
		var meta = response.meta;
		var data = response.data;
		console.log("meta: ", meta);
		console.log("data: ", data);
		return data;
	}

	// [Step 1] Assign an existing global variable named myCallBackMethod to the return of proxy function
	// Then call the constant variable proxy as a function
	window.myCallBackMethod = function(data) { return proxy(data); }

	// [Step 2] Call the fetch method from jQuery
	// They say you only need to do the callback and not a promise
	$.ajax(settings)
		.then(function(response) {
			console.log("returned GET data: ", response);
		});

	// So when ajax returns it will run the callback function called proxy. proxy basically reorganizes the data received from the server, the callback function proxy does not help one to gain access to the data it only reorganizes the data.  If one wants to gain access to the data directly, a callback is not needed.
	
	// So then does ajax return the result of myCallBackMethod

}

// -----------------------------------------------

	
async function run_selection_w_CORS() {

  var settings = {
		url: url,
		type : 'GET',
		dataType: 'json',
		async: true,
		crossDomain: true,
		success: function(response) { console.log(response); },
		error: function(xhr, status, error) { console.log('Error:', error); }
	};

  $.ajax(settings).done(function(response) { console.log('response: ', response); })

}

// -----------------------------------------------

</script>

  
</body>
</html>
