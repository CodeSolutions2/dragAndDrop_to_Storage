<!DOCTYPE html>
<html>
<head></head>
    
<body>

<button type="button" id="run_process" onclick="run_process()" style="display:block">run_process</button>

<input type="text" name="" id="input" value="" placeholder="input" style="display:block;">
    
<script>

async function run_process() {
    
    const displayMediaOptions = { video: { displaySurface: "browser", },
                                 audio: { echoCancellation: true,
                                         noiseSuppression: true,
                                         sampleRate: 44100 },
                                 preferCurrentTab: false,
                                 selfBrowserSurface: "exclude",
                                 systemAudio: "include",
                                 surfaceSwitching: "include",
                                 monitorTypeSurfaces: "include",
                                };
    
    await navigator.mediaDevices.getDisplayMedia(displayMediaOptions)
        .then(stream => {
            
            var options = {mimeType: "video/webm"};
            var mediaRecorder = new MediaRecorder(stream, options);
            
            mediaRecorder.ondataavailable = handleDataAvailable;
            mediaRecorder.start();
        });

}

// -------------------------------------------------
    
function handleDataAvailable(event) {

    var recordedChunks = [];
    
    if (event.data.size > 0) {
        recordedChunks.push(event.data);
        download_screen_recording_video(recordedChunks);
    }
}

// -------------------------------------------------
  
function download_screen_recording_video(recordedChunks) {
    
      var blob = new Blob(recordedChunks, {type: "video/webm"});
      var url = URL.createObjectURL(blob);
      var a = document.createElement("a");
      document.body.appendChild(a);
      a.setAttribute('style', 'display:none');
      a.setAttribute('href', url);
      a.setAttribute('download', 'test.webm');
      
      a.click();
  
      window.URL.revokeObjectURL(url);
}

// -------------------------------------------------

</script>
</body>
</html>
