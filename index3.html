<!DOCTYPE html>
<html>
<head></head>
    
<body>

</body>


<script>

window.onload = async (event) => { await run_it(); };


async function run_it() {
    
    var n = 5;
    var k = 2;
    var S = Array.from({length: n}, (_,i) => i+1);
    console.log('S: ', S);

    // Create a
    var lowest_val = S.sort().shift();
    console.log('lowest_val: ',lowest_val);
    var a = [];
    var b = [];
    for (let i=lowest_val; i < n; i++) {
        // Create a
        let temp = Array.from({length: n-i}, (_,index) => i);
        a = a.concat(temp);

        // Create b
        let temp_b = Array.from({length: n-i}, (_,index) => index+(i+1));
        b = b.concat(temp_b);
    }
    console.log('a: ', a);
    console.log('b: ', b);

    // Find the max decimal number after bitwise AND operation on binary values
    var bin_a_str;
    var bin_b_str;
    var binary_str;
    var decimal_num;
    var decimal_arr = [];
    // for (let i=0; i<a.length; i++) {
    for (let i=0; i<2; i++) {
        bin_a_str = await convert_decimal_to_binary(a.at(i));
        console.log('bin_a_str: ', bin_a_str);
        
        bin_b_str = await convert_decimal_to_binary(b.at(i));
        console.log('bin_b_str: ', bin_b_str);
        
        binary_str = await bitwise_AND(bin_a_str, bin_b_str);
        console.log('binary_str: ', binary_str);
        
        decimal_num = await convert_binary_to_decimal(binary_str);
        console.log('decimal_num: ', decimal_num);
        
        decimal_arr.push(decimal_num);
    }
    decimal_arr = decimal_arr.sort();
    console.log('decimal_arr: ', decimal_arr);
    
    var max_num = decimal_arr.pop();
    console.log('max_num: ', max_num);
    
    var max_loop_num = 0;
    while (max_num > k && max_loop_num < decimal_arr.length) {
        // keep taking a value from the end of the sorted array until it is satisfied
        max_num = decimal_arr.pop();
        max_loop_num += 1;
    }
    return max_num;
}

async function convert_decimal_to_binary(decimal_num) {

    // convert base-10 (decimal) to base-2 (binary)
    var binary_number = [];
    while (Math.floor(decimal_num/2) > 0) {

        if (decimal_num % 2 != 0) {
            binary_number.push(1);
        } else {
            binary_number.push(0);
        }
    }
    // concatenate the remainder bits from most to least significant (ie: (71)_10 = (1000111)_2 )
    return binary_number.join('');
}

async function bitwise_AND(bin_a_str, bin_b_str) {

    // Only works if a and b are the same length
    var a = bin_a_str.split("").map((val, ind) => { return Number(val); });
    var b = bin_b_str.split("").map((val, ind) => { return Number(val); });

    // perform a & b
    var binary_a_and_b = [];
    a.map((val, ind) => {
        if (val == 1 && b.at(ind) == 1) {
            binary_a_and_b.push(1);
        } else {
            binary_a_and_b.push(0);
        } 
    });
    return binary_a_and_b.join('');
}


async function convert_binary_to_decimal(binary_str) {
    var bin_arr = binary_str.split("").map((val, ind) => { return Number(val); });

    var decimal_num = 0;
    for (let i=0; i<bin_arr.length; i++) {
        // sum from least to most significant bit
        decimal_num = decimal_num + (bin_arr.at(i)*Math.pow(2, i));
    }
    return decimal_num;
}
    
</script>
  
</html>
