<!DOCTYPE html>
<html>
<head></head>
    
<body>

</body>


<script>

window.onload = async (event) => { await run_it(); };


async function run_it() {
    
    var n = 9;
    var k = 2;
    var S = Array.from({length: n}, (_,i) => i+1);
    // console.log('S: ', S);

    // Create a
    var lowest_val = S.sort().shift();
    
    var a = [];
    var b = [];
    for (let i=lowest_val; i < n; i++) {
        // Create a
        let temp = Array.from({length: n-i}, (_,index) => i);
        a = a.concat(temp);

        // Create b
        let temp_b = Array.from({length: n-i}, (_,index) => index+(i+1));
        b = b.concat(temp_b);
    }
    // console.log('a: ', a);
    // console.log('b: ', b);

    // Find the max decimal number after bitwise AND operation on binary values
    var bin_a_str;
    var bin_b_str;
    var bin_str;
    var binary_str = [];
    
    for (let i=0; i<a.length; i++) {

        // console.log('a.at(i): ', a.at(i));
        bin_a_str = await convert_decimal_to_binary(a.at(i));
        // console.log('bin_a_str: ', bin_a_str);
        // console.log('bin_a_str.length: ', bin_a_str.length);
        
        // console.log('b.at(i): ', b.at(i));
        bin_b_str = await convert_decimal_to_binary(b.at(i));
        // console.log('bin_b_str: ', bin_b_str);
        // console.log('bin_b_str.length: ', bin_b_str.length);
        
        // make bin_a_str and bin_b_str the same length by padding zeros to the left
        if (bin_a_str.length > bin_b_str.length) {
            let zeros = Array.from({length: bin_a_str.length-bin_b_str.length}, (_,index) => 0);
            bin_b_str = bin_b_str.split("").map((val, ind) => { return Number(val); });
            bin_b_str = zeros.concat(bin_b_str).join("");
        } else if (bin_a_str.length < bin_b_str.length) {
            let zeros = Array.from({length: bin_b_str.length-bin_a_str.length}, (_,index) => 0);
            bin_a_str = bin_a_str.split("").map((val, ind) => { return Number(val); });
            bin_a_str = zeros.concat(bin_a_str).join("");
        }
        // console.log('bin_a_str: ', bin_a_str);
        // console.log('bin_b_str: ', bin_b_str);

        bin_str = await bitwise_AND(bin_a_str, bin_b_str);
        binary_str.push(bin_str);
        // console.log('binary_str: ', binary_str);
    }

    // --------------------------------------------------

    // Pad the binary_str

    // get max length for binary strings
    var binary_str_len = binary_str.map((val, ind) => { return val.length; });
    var max_val = binary_str_len.sort().pop();

    var binary_str_same_len = [];
    for (let i=0; i<binary_str.length; i++) {
        let zeros = Array.from({length: max_val-binary_str.at(i).length}, (_,index) => 0);
        let temp = binary_str.at(i).split("").map((val, ind) => { return Number(val); });
        bin_str = zeros.concat(temp).join("");
        binary_str_same_len.push(bin_str);
    }
    // console.log('binary_str_same_len: ', binary_str_same_len);
        
    // --------------------------------------------------
        
    var decimal_num;
    var decimal_arr = [];
    for (let i=0; i<binary_str_same_len.length; i++) {
        decimal_num = await convert_binary_to_decimal(binary_str_same_len.at(i));
        decimal_arr.push(decimal_num);
    }
    // console.log('decimal_arr: ', decimal_arr);
    decimal_arr = decimal_arr.sort();

    // --------------------------------------------------
    
    var max_num = decimal_arr.pop();
    
    var max_loop_num = 0;
    while (max_num > k && max_loop_num < decimal_arr.length) {
        // keep taking a value from the end of the sorted array until it is satisfied
        max_num = decimal_arr.pop();
        max_loop_num += 1;
    }
    return max_num;
}


async function convert_decimal_to_binary(decimal_num) {

    // convert base-10 (decimal) to base-2 (binary)
    var binary_number = [];
    var decimal_num2 = Math.floor(decimal_num/2);
    
    while (decimal_num != 0) {
        if (decimal_num % 2 == 0) {
            // There is no remainder if (decimal_num % 2 == 0), put 0
            binary_number.push(0);
        } else {
            binary_number.push(1);
        }
        decimal_num = decimal_num2;
        decimal_num2 = Math.floor(decimal_num/2);
    }
    // Inverse binary_number because they are pushed in from left to right.
    // Then, concatenate the remainder bits from most to least significant (ie: (71)_10 = (1000111)_2 )
    return binary_number.toReversed().join("");
}

    
async function bitwise_AND(bin_a_str, bin_b_str) {

    // Only works if a and b are the same length
    var a = bin_a_str.split("").map((val, ind) => { return Number(val); });
    var b = bin_b_str.split("").map((val, ind) => { return Number(val); });

    // perform a & b
    var binary_a_and_b = [];
    a.map((val, ind) => {
        if (val == 1 && b.at(ind) == 1) {
            binary_a_and_b.push(1);
        } else {
            binary_a_and_b.push(0);
        } 
    });
    return binary_a_and_b.join('');
}


async function convert_binary_to_decimal(binary_str) {
    var bin_arr = binary_str.split("").map((val, ind) => { return Number(val); });

    // Reverse the array
    bin_arr = bin_arr.toReversed();
    
    var decimal_num = 0;
    for (let i=0; i<bin_arr.length; i++) {
        // sum from least to most significant bit
        decimal_num = decimal_num + (bin_arr.at(i) * Math.pow(2, i));
    }
    return decimal_num;
}
    
</script>
  
</html>
